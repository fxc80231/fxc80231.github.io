<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>企业营销合同数据分析看板</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <style>
    :root {
      --primary: #2c7be5;
      --secondary: #6c757d;
      --success: #00d97e;
      --danger: #e63757;
      --light: #f8f9fa;
      --dark: #283446;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      color: #495057;
      line-height: 1.6;
      padding: 20px;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    h1 {
      color: var(--dark);
      font-size: 28px;
    }
    
    .download-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(44, 123, 229, 0.3);
      transition: all 0.3s;
    }
    
    .download-btn:hover {
      background: #1a68d1;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(44, 123, 229, 0.4);
    }
    
    .kpi-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .kpi-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s;
    }
    
    .kpi-card:hover {
      transform: translateY(-5px);
    }
    
    .kpi-title {
      font-size: 16px;
      color: var(--secondary);
      margin-bottom: 10px;
    }
    
    .kpi-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .kpi-change {
      font-size: 14px;
      font-weight: 600;
    }
    
    .positive {
      color: var(--success);
    }
    
    .negative {
      color: var(--danger);
    }
    
    .analysis-section {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
      line-height: 1.8;
    }
    
    .charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .chart-title {
      text-align: center;
      font-size: 18px;
      color: var(--dark);
      margin-bottom: 15px;
    }
    
    .chart-container {
      height: 380px;
      position: relative;
    }
    
    .data-table-container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow-x: auto;
      margin-bottom: 40px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1000px;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e9ecef;
    }
    
    th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: var(--dark);
    }
    
    tbody tr:hover {
      background-color: #f8f9fa;
    }
    
    .footer {
      text-align: center;
      padding: 20px;
    }
    
    .fixed-download {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }
    
    @media (max-width: 768px) {
      .charts-container {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        height: 320px;
      }
      
      .fixed-download {
        position: static;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>企业营销合同数据分析看板</h1>
      <button class="download-btn fixed-download" onclick="downloadWord()">一键下载Word文档</button>
    </div>
    
    <div class="kpi-container">
      <div class="kpi-card">
        <div class="kpi-title">本月合同总额</div>
        <div class="kpi-value">9,675,523.94元</div>
        <div class="kpi-change">
          环比: <span class="positive">↑31.68%</span><br>
          同比: <span class="positive">↑16.25%</span>
        </div>
      </div>
      
      <div class="kpi-card">
        <div class="kpi-title">本月合同利润</div>
        <div class="kpi-value">7,496,623.32元</div>
        <div class="kpi-change">
          环比: <span class="positive">↑35.65%</span><br>
          同比: <span class="positive">↑18.55%</span>
        </div>
      </div>
      
      <div class="kpi-card">
        <div class="kpi-title">本月合同单数</div>
        <div class="kpi-value">1,344单</div>
        <div class="kpi-change">
          环比: <span class="positive">↑12.47%</span><br>
          同比: <span class="negative">↓5.21%</span>
        </div>
      </div>
      
      <div class="kpi-card">
        <div class="kpi-title">平均合同单价</div>
        <div class="kpi-value">5,577.84元</div>
        <div class="kpi-change">
          环比: <span class="positive">↑20.61%</span><br>
          同比: <span class="positive">↑12.24%</span>
        </div>
      </div>
    </div>
    
    <div class="analysis-section">
      <h2>分析总结</h2>
      <p>
        11月企业合同数据呈现显著增长态势，合同总额达967.55万元，环比增长31.68%，同比增长16.25%。合同利润实现749.66万元，环比增长35.65%，反映出经营效益的持续改善。从业务结构看，营销部贡献最大，合同金额达376.11万元，占比38.88%；全民营销以246.73万元位居第二，占比25.50%。值得注意的是新媒体渠道增长迅猛，合同金额环比增长146.18%，成为重要增长点。
      </p>
      <p>
        风险点主要体现为全民营销部门合同利润占比低于金额占比，利润率仅为77.51%，低于整体77.48%的平均水平。同时，交付中心部门应付佣金占合同金额比例高达25.27%，显著高于其他部门。建议优化全民营销成本结构，提高人均产出效率；对交付中心佣金政策进行重新评估，平衡激励与利润关系。
      </p>
      <p>
        从趋势看，近三月合同金额稳步上升，但单数增长幅度小于金额增长，表明大客户贡献比例提升。会销部表现突出，合同利润率高达95.44%，建议复制其成功经验。未来应重点关注高利润部门资源投入，同时加强新媒体渠道建设，控制全民营销和交付中心的成本支出，以实现利润最大化。
      </p>
    </div>
    
    <div class="charts-container">
      <div class="chart-card">
        <div class="chart-title">各部门合同金额排名（万元）</div>
        <div class="chart-container">
          <canvas id="barChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <div class="chart-title">合同金额部门分布</div>
        <div class="chart-container">
          <canvas id="pieChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <div class="chart-title">近三月合同金额趋势（万元）</div>
        <div class="chart-container">
          <canvas id="lineChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <div class="chart-title">各部门合同利润排名（万元）</div>
        <div class="chart-container">
          <canvas id="horizontalBarChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="data-table-container">
      <h2>详细数据对比分析</h2>
      <table>
        <thead>
          <tr>
            <th>部门</th>
            <th>11月金额(元)</th>
            <th>10月金额(元)</th>
            <th>9月金额(元)</th>
            <th>金额环比</th>
            <th>11月利润(元)</th>
            <th>10月利润(元)</th>
            <th>9月利润(元)</th>
            <th>利润环比</th>
            <th>11月单数</th>
            <th>10月单数</th>
            <th>9月单数</th>
            <th>单数环比</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>营销部</td>
            <td>3,761,089.38</td>
            <td>3,102,411.28</td>
            <td>4,859,092.63</td>
            <td class="positive">21.22%</td>
            <td>2,734,272.15</td>
            <td>2,499,117.95</td>
            <td>3,707,611.15</td>
            <td class="positive">9.41%</td>
            <td>523</td>
            <td>505</td>
            <td>670</td>
            <td class="positive">3.56%</td>
          </tr>
          <tr>
            <td>全民营销</td>
            <td>2,467,254.96</td>
            <td>2,176,385.60</td>
            <td>2,352,318.32</td>
            <td class="positive">13.36%</td>
            <td>1,912,336.93</td>
            <td>1,398,428.29</td>
            <td>1,615,683.38</td>
            <td class="positive">36.76%</td>
            <td>417</td>
            <td>352</td>
            <td>438</td>
            <td class="positive">18.47%</td>
          </tr>
          <tr>
            <td>会销部</td>
            <td>1,157,117.04</td>
            <td>710,466.58</td>
            <td>996,529.00</td>
            <td class="positive">62.87%</td>
            <td>1,104,517.87</td>
            <td>686,431.93</td>
            <td>960,431.71</td>
            <td class="positive">60.94%</td>
            <td>103</td>
            <td>48</td>
            <td>94</td>
            <td class="positive">114.58%</td>
          </tr>
          <tr>
            <td>门店业务</td>
            <td>465,502.00</td>
            <td>506,196.00</td>
            <td>347,934.00</td>
            <td class="negative">-8.04%</td>
            <td>382,026.03</td>
            <td>252,555.04</td>
            <td>315,111.68</td>
            <td class="positive">51.30%</td>
            <td>145</td>
            <td>116</td>
            <td>170</td>
            <td class="positive">25.00%</td>
          </tr>
          <tr>
            <td>交付中心</td>
            <td>1,045,070.00</td>
            <td>298,100.00</td>
            <td>460,224.00</td>
            <td class="positive">250.72%</td>
            <td>693,029.30</td>
            <td>219,639.00</td>
            <td>333,911.76</td>
            <td class="positive">215.53%</td>
            <td>10</td>
            <td>7</td>
            <td>14</td>
            <td class="positive">42.86%</td>
          </tr>
          <tr>
            <td>新媒体</td>
            <td>283,131.98</td>
            <td>115,018.21</td>
            <td>604,754.25</td>
            <td class="positive">146.18%</td>
            <td>258,268.65</td>
            <td>108,459.03</td>
            <td>477,785.75</td>
            <td class="positive">138.07%</td>
            <td>117</td>
            <td>127</td>
            <td>218</td>
            <td class="negative">-7.87%</td>
          </tr>
          <tr>
            <td>招商加盟部</td>
            <td>208,600.00</td>
            <td>127,200.00</td>
            <td>231,600.00</td>
            <td class="positive">64.00%</td>
            <td>197,574.00</td>
            <td>125,928.00</td>
            <td>215,814.00</td>
            <td class="positive">56.89%</td>
            <td>7</td>
            <td>6</td>
            <td>15</td>
            <td class="positive">16.67%</td>
          </tr>
          <tr>
            <td>加盟商</td>
            <td>210,300.00</td>
            <td>123,780.00</td>
            <td>349,776.00</td>
            <td class="positive">69.90%</td>
            <td>164,462.00</td>
            <td>101,222.20</td>
            <td>301,378.24</td>
            <td class="positive">62.50%</td>
            <td>8</td>
            <td>7</td>
            <td>11</td>
            <td class="positive">14.29%</td>
          </tr>
          <tr>
            <td>合道市场部</td>
            <td>55,730.00</td>
            <td>120,300.00</td>
            <td>326,314.50</td>
            <td class="negative">-53.68%</td>
            <td>33,537.70</td>
            <td>89,741.00</td>
            <td>167,732.39</td>
            <td class="negative">-62.63%</td>
            <td>8</td>
            <td>17</td>
            <td>26</td>
            <td class="negative">-52.94%</td>
          </tr>
          <tr>
            <td>城市合伙人</td>
            <td>21,728.58</td>
            <td>69,688.61</td>
            <td>137,321.93</td>
            <td class="negative">-68.82%</td>
            <td>16,598.69</td>
            <td>45,277.82</td>
            <td>99,789.27</td>
            <td class="negative">-63.35%</td>
            <td>6</td>
            <td>10</td>
            <td>11</td>
            <td class="negative">-40.00%</td>
          </tr>
          <tr>
            <td>邦财大会销</td>
            <td>-</td>
            <td>-</td>
            <td>143,601.98</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>103,225.96</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>3</td>
            <td>-</td>
          </tr>
          <tr class="highlight">
            <td>汇总</td>
            <td>9,675,523.94</td>
            <td>7,349,546.28</td>
            <td>10,809,466.61</td>
            <td class="positive">31.68%</td>
            <td>7,496,623.32</td>
            <td>5,526,800.26</td>
            <td>8,298,475.29</td>
            <td class="positive">35.65%</td>
            <td>1,344</td>
            <td>1,195</td>
            <td>1,670</td>
            <td class="positive">12.47%</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="footer">
      <button class="download-btn" onclick="downloadWord()">下载完整分析报告</button>
    </div>
  </div>

  <script>
    // 数据处理
    const departments = [
      '营销部', '全民营销', '会销部', '门店业务', '交付中心',
      '新媒体', '招商加盟部', '加盟商', '合道市场部', '城市合伙人'
    ];
    
    const novData = {
      contractAmount: [3761089.38, 2467254.96, 1157117.04, 465502, 1045070, 
                       283131.98, 208600, 210300, 55730, 21728.58],
      profit: [2734272.15, 1912336.93, 1104517.87, 382026.03, 693029.3,
               258268.65, 197574, 164462, 33537.7, 16598.69],
      orders: [523, 417, 103, 145, 10, 117, 7, 8, 8, 6]
    };
    
    const octData = {
      contractAmount: [3102411.28, 2176385.6, 710466.58, 506196, 298100,
                       115018.21, 127200, 123780, 120300, 69688.61],
      profit: [2499117.95, 1398428.29, 686431.93, 252555.04, 219639,
               108459.03, 125928, 101222.2, 89741, 45277.82],
      orders: [505, 352, 48, 116, 7, 127, 6, 7, 17, 10]
    };
    
    const monthlyTrend = {
      months: ['9月', '10月', '11月'],
      contractAmount: [10809466.61, 7349546.28, 9675523.94],
      profit: [8298475.29, 5526800.26, 7496623.32],
      orders: [1670, 1195, 1344]
    };
    
    // 格式化数字
    function formatNumber(num) {
      return num.toLocaleString('zh-CN', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }
    
    // 万元格式化
    function formatWan(num) {
      return (num / 10000).toLocaleString('zh-CN', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }
    
    // 图表颜色配置
    const chartColors = [
      '#2c7be5', '#ff7f0e', '#1ca9c9', '#d4526e', '#f45b5b',
      '#8e44ad', '#27ae60', '#f39c12', '#3498db', '#e74c3c'
    ];
    
    // 创建柱状图
    function createBarChart() {
      const ctx = document.getElementById('barChart').getContext('2d');
      const data = novData.contractAmount.map(amount => amount / 10000);
      
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: departments,
          datasets: [{
            label: '合同金额 (万元)',
            data: data,
            backgroundColor: chartColors,
            borderColor: chartColors.map(color => color.replace('0.8', '1')),
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
              anchor: 'end',
              align: 'top',
              formatter: value => formatNumber(value),
              color: '#495057',
              font: {
                weight: 'bold'
              }
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '合同金额 (万元)'
              }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }
    
    // 创建饼图
    function createPieChart() {
      const ctx = document.getElementById('pieChart').getContext('2d');
      const total = novData.contractAmount.reduce((sum, val) => sum + val, 0);
      const percentages = novData.contractAmount.map(amount => (amount / total * 100).toFixed(1));
      
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: departments,
          datasets: [{
            data: novData.contractAmount,
            backgroundColor: chartColors,
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
              formatter: (value, ctx) => {
                const index = ctx.dataIndex;
                return `${departments[index]}\n${percentages[index]}%\n${formatNumber(value)}元`;
              },
              color: '#fff',
              font: {
                weight: 'bold',
                size: 10
              },
              textAlign: 'center'
            },
            legend: {
              position: 'right',
              labels: {
                boxWidth: 15,
                padding: 15,
                usePointStyle: true
              }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }
    
    // 创建折线图
    function createLineChart() {
      const ctx = document.getElementById('lineChart').getContext('2d');
      const data = monthlyTrend.contractAmount.map(amount => amount / 10000);
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: monthlyTrend.months,
          datasets: [{
            label: '合同金额 (万元)',
            data: data,
            borderColor: '#2c7be5',
            backgroundColor: 'rgba(44, 123, 229, 0.1)',
            borderWidth: 3,
            pointBackgroundColor: '#2c7be5',
            pointRadius: 6,
            pointHoverRadius: 8,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
              anchor: 'center',
              align: 'top',
              formatter: value => formatNumber(value),
              color: '#2c7be5',
              font: {
                weight: 'bold'
              }
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              title: {
                display: true,
                text: '合同金额 (万元)'
              }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }
    
    // 创建横向条形图
    function createHorizontalBarChart() {
      const ctx = document.getElementById('horizontalBarChart').getContext('2d');
      const data = novData.profit.map(profit => profit / 10000);
      
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: departments,
          datasets: [{
            label: '合同利润 (万元)',
            data: data,
            backgroundColor: chartColors,
            borderColor: chartColors.map(color => color.replace('0.8', '1')),
            borderWidth: 1
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            datalabels: {
              anchor: 'end',
              align: 'right',
              formatter: value => formatNumber(value),
              color: '#495057',
              font: {
                weight: 'bold'
              }
            },
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              title: {
                display: true,
                text: '合同利润 (万元)'
              }
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }
    
    // 下载Word文档功能
    function downloadWord() {
      const dashboard = document.getElementById('dashboard');
      const clone = dashboard.cloneNode(true);
      
      // 替换canvas为图片
      const canvases = clone.querySelectorAll('canvas');
      canvases.forEach(canvas => {
        const img = new Image();
        img.src = canvas.toDataURL('image/png');
        img.style.width = canvas.width + 'px';
        img.style.height = canvas.height + 'px';
        canvas.parentNode.replaceChild(img, canvas);
      });
      
      const content = clone.innerHTML;
      const converted = htmlDocx.asBlob(content);
      saveAs(converted, '企业营销合同数据分析看板.docx');
    }
    
    // 初始化图表
    document.addEventListener('DOMContentLoaded', () => {
      createBarChart();
      createPieChart();
      createLineChart();
      createHorizontalBarChart();
    });
  </script>
</body>
</html>