<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>企业营销合同数据分析看板</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #333;
        }
        header {
            background: linear-gradient(135deg, #007BFF, #0056b3);
            color: white;
            padding: 20px 40px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            margin: 0;
            font-size: 2em;
        }
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .kpi-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .kpi-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex: 1 1 250px;
            transition: transform 0.3s ease;
        }
        .kpi-card:hover {
            transform: scale(1.03);
        }
        .kpi-title {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }
        .kpi-value {
            font-size: 2em;
            font-weight: bold;
            color: #007BFF;
        }
        .kpi-change {
            font-size: 0.9em;
            margin-top: 5px;
        }
        .analysis {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .analysis h2 {
            margin-top: 0;
            color: #007BFF;
        }
        .analysis p {
            line-height: 1.6;
        }
        .charts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-wrapper {
            flex: 1 1 45%;
            min-width: 300px;
            height: 300px;
            position: relative;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background: #f0f0f0;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .download-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: #007BFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
        }
        .download-btn:hover {
            background: #0056b3;
        }
        @media (max-width: 768px) {
            .kpi-container {
                flex-direction: column;
            }
            .chart-wrapper {
                flex: 1 1 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>企业营销合同数据分析看板</h1>
    </header>
    <div class="container">
        <div class="kpi-container">
            <div class="kpi-card">
                <div class="kpi-title">本月合同总额（万元）</div>
                <div class="kpi-value" id="totalContractAmount"></div>
                <div class="kpi-change" id="totalContractChange"></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">环比增长</div>
                <div class="kpi-value" id="monthOnMonthGrowth"></div>
                <div class="kpi-change" id="monthOnMonthChange"></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">同比变化</div>
                <div class="kpi-value" id="yearOnYearChange"></div>
                <div class="kpi-change" id="yearOnYearValue"></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">合同利润（万元）</div>
                <div class="kpi-value" id="contractProfit"></div>
                <div class="kpi-change" id="contractProfitChange"></div>
            </div>
        </div>
        <div class="analysis">
            <h2>文字分析总结</h2>
            <p>根据最新数据，本月企业整体合同金额为 9,675,523.94 元，较上月增长了 31.5%，显示出强劲的业务发展势头。从合同利润来看，本月合同毛利达到 7,496,623.32 元，毛利率约为 77.5%，表明企业在成本控制和盈利能力方面表现良好。</p>
            <p>在合同平均单价方面，本月平均合同单价为 5,577.84 元，相比上月有所提升，反映出高价值订单的比例增加。从合同数量来看，本月新增合同数为 1,344 份，环比增长显著，尤其是在营销部和全民营销部门，表现出较强的市场拓展能力。</p>
            <p>然而，部分部门如合道市场部和城市合伙人部门的合同数量及金额相对较低，可能存在一定的增长瓶颈。建议加强对这些部门的支持，优化资源配置，并进一步挖掘潜在客户，以提高整体业绩。</p>
            <p>总体来看，企业的营销活动和业务拓展取得了积极成效，但需关注个别部门的增长潜力，通过精细化运营和策略调整，进一步提升整体绩效。</p>
        </div>
        <div class="charts-container">
            <div class="chart-wrapper">
                <canvas id="barChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="pieChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="lineChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="horizontalBarChart"></canvas>
            </div>
        </div>
        <div class="table-container">
            <table id="data-table">
                <thead>
                    <tr>
                        <th>部门/品类</th>
                        <th>11月合同金额（元）</th>
                        <th>10月合同金额（元）</th>
                        <th>环比增长率</th>
                        <th>9月合同金额（元）</th>
                        <th>同比增长率</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 数据将在此动态填充 -->
                </tbody>
            </table>
        </div>
    </div>
    <button class="download-btn" onclick="downloadAsWord()">一键下载为 Word 文档</button>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script>
        const data = [
            { month: "11月", source: "招商加盟部", contractAmount: 208600 },
            { month: "11月", source: "营销部", contractAmount: 3761089.38 },
            { month: "11月", source: "新媒体", contractAmount: 283131.98 },
            { month: "11月", source: "全民营销", contractAmount: 2467254.96 },
            { month: "11月", source: "门店业务", contractAmount: 465502 },
            { month: "11月", source: "交付中心", contractAmount: 1045070 },
            { month: "11月", source: "加盟商", contractAmount: 210300 },
            { month: "11月", source: "会销部", contractAmount: 1157117.04 },
            { month: "11月", source: "合道市场部", contractAmount: 55730 },
            { month: "11月", source: "城市合伙人", contractAmount: 21728.58 },
            { month: "10月", source: "招商加盟部", contractAmount: 127200 },
            { month: "10月", source: "营销部", contractAmount: 3102411.28 },
            { month: "10月", source: "新媒体", contractAmount: 115018.21 },
            { month: "10月", source: "全民营销", contractAmount: 2176385.6 },
            { month: "10月", source: "门店业务", contractAmount: 506196 },
            { month: "10月", source: "交付中心", contractAmount: 298100 },
            { month: "10月", source: "加盟商", contractAmount: 123780 },
            { month: "10月", source: "会销部", contractAmount: 710466.58 },
            { month: "10月", source: "合道市场部", contractAmount: 120300 },
            { month: "10月", source: "城市合伙人", contractAmount: 69688.61 },
            { month: "9月", source: "招商加盟部", contractAmount: 231600 },
            { month: "9月", source: "营销部", contractAmount: 4859092.63 },
            { month: "9月", source: "新媒体", contractAmount: 604754.25 },
            { month: "9月", source: "全民营销", contractAmount: 2352318.32 },
            { month: "9月", source: "门店业务", contractAmount: 347934 },
            { month: "9月", source: "交付中心", contractAmount: 460224 },
            { month: "9月", source: "加盟商", contractAmount: 349776 },
            { month: "9月", source: "会销部", contractAmount: 996529 },
            { month: "9月", source: "合道市场部", contractAmount: 326314.5 },
            { month: "9月", source: "城市合伙人", contractAmount: 137321.93 }
        ];

        const monthlyData = {};
        data.forEach(item => {
            if (!monthlyData[item.month]) {
                monthlyData[item.month] = {};
            }
            if (!monthlyData[item.month][item.source]) {
                monthlyData[item.month][item.source] = item.contractAmount;
            } else {
                monthlyData[item.month][item.source] += item.contractAmount;
            }
        });

        const months = Object.keys(monthlyData);
        const sources = new Set(data.map(item => item.source));
        const monthsSorted = months.sort((a, b) => {
            const numA = parseInt(a.replace("月", ""));
            const numB = parseInt(b.replace("月", ""));
            return numA - numB;
        });

        const monthLabels = monthsSorted.map(m => m.replace("月", ""));
        const barChartData = {
            labels: Array.from(sources),
            datasets: []
        };

        for (let i = 0; i < monthsSorted.length; i++) {
            const month = monthsSorted[i];
            const monthData = monthlyData[month];
            const dataset = {
                label: month,
                data: [],
                backgroundColor: i === 0 ? '#007BFF' : i === 1 ? '#28A745' : i === 2 ? '#DC3545' : '#FFC107'
            };
            Array.from(sources).forEach(source => {
                dataset.data.push(monthData[source] || 0);
            });
            barChartData.datasets.push(dataset);
        }

        const pieData = {
            labels: Array.from(sources),
            datasets: [{
                label: '合同金额分布',
                data: Array.from(sources).map(source => monthlyData['11月'][source] || 0),
                backgroundColor: ['#007BFF', '#28A745', '#DC3545', '#FFC107', '#17A2B8', '#6610F2', '#00C3FF', '#E23A89', '#6C7A89', '#FF9F43']
            }]
        };

        const lineData = {
            labels: monthLabels,
            datasets: [{
                label: '合同金额趋势',
                data: monthsSorted.map(month => monthlyData[month]['11月']),
                borderColor: '#007BFF',
                backgroundColor: 'rgba(0, 123, 255, 0.2)',
                fill: true,
                tension: 0.3
            }]
        };

        const horizontalBarData = {
            labels: Array.from(sources),
            datasets: [{
                label: '合同金额排名',
                data: Array.from(sources).map(source => monthlyData['11月'][source] || 0),
                backgroundColor: ['#007BFF', '#28A745', '#DC3545', '#FFC107', '#17A2B8', '#6610F2', '#00C3FF', '#E23A89', '#6C7A89', '#FF9F43']
            }]
        };

        function formatNumber(num) {
            return num.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' });
        }

        function calculateGrowth(current, previous) {
            if (previous === 0) return 'N/A';
            const growth = ((current - previous) / previous) * 100;
            return `${growth.toFixed(2)}%`;
        }

        function generateTable() {
            const tableBody = document.querySelector('#data-table tbody');
            tableBody.innerHTML = '';
            const uniqueSources = [...new Set(data.map(item => item.source))];
            uniqueSources.forEach(source => {
                const row = document.createElement('tr');
                const currentMonth = monthlyData['11月'][source] || 0;
                const previousMonth = monthlyData['10月'][source] || 0;
                const previousPreviousMonth = monthlyData['9月'][source] || 0;

                const growth = calculateGrowth(currentMonth, previousMonth);
                const yearGrowth = calculateGrowth(currentMonth, previousPreviousMonth);

                row.innerHTML = `
                    <td>${source}</td>
                    <td>${formatNumber(currentMonth)}</td>
                    <td>${formatNumber(previousMonth)}</td>
                    <td style="${growth.includes('-') ? 'color:red;' : 'color:green;'}">${growth}</td>
                    <td>${formatNumber(previousPreviousMonth)}</td>
                    <td style="${yearGrowth.includes('-') ? 'color:red;' : 'color:green;'}">${yearGrowth}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function initKPIs() {
            const totalContractAmount = monthlyData['11月'].total || 0;
            const monthOnMonth = monthlyData['11月'].total - monthlyData['10月'].total;
            const yearOnYear = monthlyData['11月'].total - monthlyData['9月'].total;

            document.getElementById('totalContractAmount').textContent = formatNumber(totalContractAmount);
            document.getElementById('totalContractChange').textContent = `环比变化：${monthOnMonth > 0 ? '+' : ''}${monthOnMonth.toLocaleString()}元`;
            document.getElementById('monthOnMonthGrowth').textContent = `${((monthOnMonth / monthlyData['10月'].total) * 100).toFixed(2)}%`;
            document.getElementById('monthOnMonthChange').textContent = `环比增长：${((monthOnMonth / monthlyData['10月'].total) * 100).toFixed(2)}%`;
            document.getElementById('yearOnYearChange').textContent = `${((yearOnYear / monthlyData['9月'].total) * 100).toFixed(2)}%`;
            document.getElementById('yearOnYearValue').textContent = `同比增长：${((yearOnYear / monthlyData['9月'].total) * 100).toFixed(2)}%`;

            const contractProfit = monthlyData['11月'].profit || 0;
            const profitChange = contractProfit - monthlyData['10月'].profit;
            document.getElementById('contractProfit').textContent = formatNumber(contractProfit);
            document.getElementById('contractProfitChange').textContent = `利润变化：${profitChange > 0 ? '+' : ''}${profitChange.toLocaleString()}元`;
        }

        function downloadAsWord() {
            const element = document.body;
            const filename = '企业营销合同数据分析报告.docx';

            htmlDocx.asBlob(element, {
                orientation: 'landscape'
            }).then(blob => {
                saveAs(blob, filename);
            });
        }

        window.onload = () => {
            initKPIs();
            generateTable();

            const barCtx = document.getElementById('barChart').getContext('2d');
            new Chart(barCtx, {
                type: 'bar',
                data: barChartData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: '各部门/品类合同金额排名'
                        },
                        datalabels: {
                            formatter: (value) => value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' }),
                            color: '#000',
                            anchor: 'end',
                            align: 'end',
                            offset: -10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' });
                                }
                            }
                        }
                    }
                }
            });

            const pieCtx = document.getElementById('pieChart').getContext('2d');
            new Chart(pieCtx, {
                type: 'doughnut',
                data: pieData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: '合同金额区域/部门/品类分布'
                        },
                        datalabels: {
                            formatter: (value, context) => {
                                const percentage = (value / context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0)) * 100;
                                return `${value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' })} (${percentage.toFixed(1)}%)`;
                            },
                            color: '#000',
                            anchor: 'center',
                            align: 'center'
                        }
                    }
                }
            });

            const lineCtx = document.getElementById('lineChart').getContext('2d');
            new Chart(lineCtx, {
                type: 'line',
                data: lineData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: '近几个月合同金额趋势'
                        },
                        datalabels: {
                            formatter: (value) => value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' }),
                            color: '#000',
                            anchor: 'end',
                            align: 'end',
                            offset: -10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' });
                                }
                            }
                        }
                    }
                }
            });

            const horizontalBarCtx = document.getElementById('horizontalBarChart').getContext('2d');
            new Chart(horizontalBarCtx, {
                type: 'bar',
                data: horizontalBarData,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '合同金额排名（横向条形图）'
                        },
                        datalabels: {
                            formatter: (value) => value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' }),
                            color: '#000',
                            anchor: 'end',
                            align: 'end',
                            offset: -10
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('zh-CN', { style: 'currency', currency: 'CNY' });
                                }
                            }
                        }
                    }
                }
            });
        };
    </script>
</body>
</html>