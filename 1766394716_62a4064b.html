<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>企业销售数据分析看板</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f5f7fa;
      color: #333;
    }
    header {
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: white;
      padding: 20px 40px;
      text-align: center;
      position: relative;
    }
    .download-btn {
      position: absolute;
      top: 20px;
      right: 40px;
      background: #fff;
      color: #3498db;
      border: 2px solid #3498db;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .download-btn:hover {
      background: #3498db;
      color: white;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .kpi-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    .kpi-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      flex: 1 1 200px;
      text-align: center;
    }
    .kpi-card h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: #3498db;
    }
    .kpi-card p {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
    }
    .analysis {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .analysis h2 {
      margin-top: 0;
      color: #2c3e50;
    }
    .charts {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      flex: 1 1 45%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      overflow-x: auto;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .positive {
      color: green;
    }
    .negative {
      color: red;
    }
    @media (max-width: 768px) {
      .charts {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>企业销售数据分析看板</h1>
    <button class="download-btn" onclick="downloadAsWord()">一键下载看板</button>
  </header>
  <div class="container">
    <div class="kpi-cards">
      <div class="kpi-card">
        <h3>合同总金额</h3>
        <p id="totalContract">¥1,234,567.89</p>
      </div>
      <div class="kpi-card">
        <h3>毛利总额</h3>
        <p id="totalGrossProfit">¥321,000.00</p>
      </div>
      <div class="kpi-card">
        <h3>同比增长率</h3>
        <p id="growthRate">+12.5%</p>
      </div>
    </div>

    <div class="analysis">
      <h2>文字分析总结</h2>
      <p><strong>营运能力：</strong>整体订单处理效率较高，但部分部门存在交付延迟情况。</p>
      <p><strong>盈利能力：</strong>毛利率保持稳定，但部分产品线利润率较低，需优化成本结构。</p>
      <p><strong>关键增长点：</strong>Q3销售额显著增长，主要得益于新客户拓展和促销活动。</p>
    </div>

    <div class="charts">
      <div class="chart-container">
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="lineChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="horizontalBarChart"></canvas>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>月份</th>
          <th>销售额</th>
          <th>毛利</th>
          <th>同比单数</th>
          <th>增长率</th>
        </tr>
      </thead>
      <tbody id="dataTable">
        <!-- 动态数据将在此填充 -->
      </tbody>
    </table>
  </div>

  <script>
    // 模拟数据（实际应从 Excel 提取）
    const data = [
      { month: '2023-01', sales: 120000, grossProfit: 30000, compare: 5, growth: 5 },
      { month: '2023-02', sales: 135000, grossProfit: 34000, compare: -2, growth: -1.5 },
      { month: '2023-03', sales: 140000, grossProfit: 36000, compare: 10, growth: 7.5 },
      { month: '2023-04', sales: 145000, grossProfit: 37000, compare: 8, growth: 5.7 },
      { month: '2023-05', sales: 150000, grossProfit: 38000, compare: 12, growth: 8.3 },
      { month: '2023-06', sales: 160000, grossProfit: 40000, compare: 15, growth: 10 },
      { month: '2023-07', sales: 170000, grossProfit: 42000, compare: 18, growth: 11.3 },
      { month: '2023-08', sales: 175000, grossProfit: 43000, compare: 20, growth: 12.5 },
      { month: '2023-09', sales: 180000, grossProfit: 44000, compare: 22, growth: 13.3 },
      { month: '2023-10', sales: 190000, grossProfit: 46000, compare: 25, growth: 14.3 },
      { month: '2023-11', sales: 200000, grossProfit: 48000, compare: 28, growth: 15.5 },
      { month: '2023-12', sales: 210000, grossProfit: 50000, compare: 30, growth: 16.7 },
    ];

    // 计算 KPI
    let totalContract = 0;
    let totalGrossProfit = 0;
    for (let item of data) {
      totalContract += item.sales;
      totalGrossProfit += item.grossProfit;
    }

    document.getElementById('totalContract').textContent = `¥${totalContract.toLocaleString()}`;
    document.getElementById('totalGrossProfit').textContent = `¥${totalGrossProfit.toLocaleString()}`;
    document.getElementById('growthRate').textContent = `${data[data.length - 1].growth}%`;

    // 填充表格
    const tableBody = document.getElementById('dataTable');
    for (let item of data) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.month}</td>
        <td>¥${item.sales.toLocaleString()}</td>
        <td>¥${item.grossProfit.toLocaleString()}</td>
        <td class="${item.compare >= 0 ? 'positive' : 'negative'}">${item.compare >= 0 ? '+' : ''}${item.compare}</td>
        <td class="${item.growth >= 0 ? 'positive' : 'negative'}">${item.growth >= 0 ? '+' : ''}${item.growth}%</td>
      `;
      tableBody.appendChild(row);
    }

    // 绘制图表
    const months = data.map(item => item.month);
    const salesData = data.map(item => item.sales);
    const grossProfitData = data.map(item => item.grossProfit);
    const departments = ['市场部', '销售部', '技术部', '客服部'];
    const departmentSales = [45000, 60000, 30000, 25000];

    new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: months,
        datasets: [{
          label: '销售额（元）',
          data: salesData,
          backgroundColor: '#3498db'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    new Chart(document.getElementById('pieChart'), {
      type: 'pie',
      data: {
        labels: departments,
        datasets: [{
          label: '部门销售额占比',
          data: departmentSales,
          backgroundColor: ['#3498db', '#2ecc71', '#e67e22', '#9b59b6']
        }]
      }
    });

    new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: months,
        datasets: [{
          label: '毛利（元）',
          data: grossProfitData,
          borderColor: '#27ae60',
          fill: false
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    new Chart(document.getElementById('horizontalBarChart'), {
      type: 'bar',
      data: {
        labels: departments,
        datasets: [{
          label: '部门销售额',
          data: departmentSales,
          backgroundColor: '#3498db'
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true
      }
    });

    function downloadAsWord() {
      const title = "企业销售数据分析看板";
      const analysisText = document.querySelector('.analysis').innerText;
      const tableHTML = document.querySelector('table').outerHTML;

      const doc = new Blob([`
        <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word">
        <head><meta charset="utf-8"><title>${title}</title></head>
        <body>
          <h1 style="text-align:center;">${title}</h1>
          <h2 style="color:#3498db;">文字分析总结</h2>
          <p>${analysisText.replace(/<[^>]+>/g, '')}</p>
          <h2 style="color:#3498db;">详细数据对比表格</h2>
          ${tableHTML}
          <h2 style="color:#3498db;">图表说明</h2>
          <p>柱状图：各月销售额趋势；饼图：各部门销售额占比；折线图：毛利变化趋势；横向条形图：各部门销售额对比。</p>
        </body>
        </html>
      `], { type: 'application/msword' });

      const link = document.createElement('a');
      link.href = URL.createObjectURL(doc);
      link.download = '企业销售数据分析看板.doc';
      link.click();
    }
  </script>
</body>
</html>